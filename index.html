<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ë¡¤ ì¹œêµ¬ ê²½ë§¤ - ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° & ëœë¤ ì¶”ì²¨ & ì…ì°°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- âœ… ì—‘ì…€(xlsx) íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                sans-serif;
            margin: 0;
            padding: 0;
            background: #0f172a;
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            padding: 16px 24px;
            background: linear-gradient(90deg, #111827, #1f2937);
            border-bottom: 1px solid #1f2937;
        }

        header h1 {
            margin: 0;
            font-size: 1.4rem;
        }

        header p {
            margin: 4px 0 0;
            font-size: 0.85rem;
            color: #9ca3af;
        }

        main {
            flex: 1;
            max-width: 1100px;
            width: 100%;
            margin: 0 auto;
            padding: 16px;
        }

        .panel {
            background: #020617;
            border-radius: 10px;
            padding: 16px 18px;
            border: 1px solid #1e293b;
            margin-bottom: 16px;
        }

        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title span {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 400;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: #1f2937;
            color: #9ca3af;
            border: 1px solid #374151;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }

        button {
            border: none;
            border-radius: 999px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            background: #3b82f6;
            color: white;
            font-weight: 600;
            transition: transform 0.05s ease-out, box-shadow 0.05s ease-out,
                background 0.2s ease-out;
        }

        button:hover {
            background: #2563eb;
            box-shadow: 0 0 0 1px #1d4ed8;
        }

        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: #4b5563;
        }

        .btn-secondary:hover {
            background: #374151;
            box-shadow: 0 0 0 1px #111827;
        }

        .file-input {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
        }

        .info-text {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .info-text strong {
            color: #e5e7eb;
        }

        .status {
            margin-top: 6px;
            font-size: 0.8rem;
        }

        .status.ok {
            color: #22c55e;
        }

        .status.warn {
            color: #facc15;
        }

        .status.error {
            color: #f97373;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 8px;
        }

        thead {
            background: #020617;
        }

        th,
        td {
            padding: 8px 6px;
            border-bottom: 1px solid #1f2937;
            text-align: center;
            white-space: nowrap;
        }

        th {
            font-weight: 600;
            color: #9ca3af;
            position: sticky;
            top: 0;
            background: #020617;
            z-index: 1;
        }

        tbody tr:nth-child(even) {
            background: #020617;
        }

        tbody tr:nth-child(odd) {
            background: #020617;
        }

        tbody tr:hover {
            background: #0b1120;
        }

        .col-index { width: 40px; }
        .col-name { width: 120px; }
        .col-lol-id { width: 160px; }
        .col-tier { width: 90px; }
        .col-pos-main,
        .col-pos-sub { width: 90px; }
        .col-attend { width: 80px; }
        .col-bid { width: 100px; }

        .table-wrapper {
            max-height: 60vh;
            overflow: auto;
            border-radius: 8px;
            border: 1px solid #1f2937;
            margin-top: 8px;
        }

        input.bid-input {
            width: 80px;
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            font-size: 0.8rem;
            text-align: right;
        }

        input.bid-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px #1d4ed8;
        }

        .footer {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
            padding: 8px 0 16px;
        }

        @media (max-width: 720px) {
            header h1 {
                font-size: 1.1rem;
            }

            .panel {
                padding: 12px;
            }

            table {
                font-size: 0.78rem;
            }

            th,
            td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
<header>
    <h1>ë¡¤ ì¹œêµ¬ ê²½ë§¤ - ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° & ëœë¤ ì¶”ì²¨ & ì…ì°°</h1>
    <p>ì—‘ì…€ì—ì„œ ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì„œ, ë‚¨ì€ ì‚¬ëŒ ì¤‘ì—ì„œ ëœë¤ìœ¼ë¡œ í•œ ëª…ì”© ë½‘ê³  ì…ì°°ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš” ğŸ’°</p>
</header>

<main>
    <!-- ì„¤ì • / ì œì–´ ì˜ì—­ -->
    <section class="panel">
        <div class="panel-title">
            ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° & ì¶”ì²¨ ì„¤ì •
            <span>Sheet1 ì²« ì¤„ì— 'ì´ë¦„ / ë‹‰ë„¤ì„ / ìµœê³ í‹°ì–´ / í˜„ì¬ í‹°ì–´ / ì£¼í¬ì§€ì…˜ / ë¶€í¬ì§€ì…˜ / ì°¸ì„ë¥ ' í—¤ë” ì‚¬ìš©</span>
        </div>

        <div class="controls">
            <!-- âœ… ì—‘ì…€ íŒŒì¼ ì„ íƒ -->
            <input
                type="file"
                id="excelInput"
                accept=".xlsx,.xls"
                class="file-input"
            />

            <!-- ëœë¤ ì¶”ì²¨ / ì´ˆê¸°í™” -->
            <button id="pickButton">ë‹¤ìŒ ì¹œêµ¬ ëœë¤ ë½‘ê¸°</button>
            <button id="resetButton" class="btn-secondary">ì „ì²´ ì´ˆê¸°í™”</button>

            <!-- ì •ë³´ ë±ƒì§€ -->
            <div class="badge" id="totalCountBadge">
                ì „ì²´ ì¹œêµ¬: 0ëª… / ë‚¨ì€: 0ëª…
            </div>
            <div class="badge" id="limitBadge">
                ìµœëŒ€ 30ëª…ê¹Œì§€ ì¶”ì²¨
            </div>
        </div>

        <div class="info-text" style="margin-top: 6px;">
            â€¢ ì—‘ì…€ <strong>Sheet1</strong>ì˜ ì²« í–‰(í—¤ë”)ì— ì•„ë˜ì™€ ê°™ì´ ì ì–´ì£¼ì„¸ìš”:  
            <strong>ì´ë¦„ / ë‹‰ë„¤ì„ / ìµœê³ í‹°ì–´ / í˜„ì¬ í‹°ì–´ / ì£¼í¬ì§€ì…˜ / ë¶€í¬ì§€ì…˜ / ì°¸ì„ë¥ </strong><br/>
            â€¢ 'í˜„ì¬ í‹°ì–´'ê°€ ë¹„ì–´ ìˆìœ¼ë©´ 'ìµœê³ í‹°ì–´'ë¥¼ ëŒ€ì‹  ì‚¬ìš©í•©ë‹ˆë‹¤. (í‘œì‹œìš© í‹°ì–´) <br/>
            â€¢ ì—‘ì…€ì„ ë¶ˆëŸ¬ì˜¨ ë’¤ <strong>ë‹¤ìŒ ì¹œêµ¬ ëœë¤ ë½‘ê¸°</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ë‚¨ì€ ì‚¬ëŒ ì¤‘ 1ëª…ì„ ëœë¤ìœ¼ë¡œ ë½‘ê³  ë‹¤ì‹œëŠ” ì•ˆ ë‚˜ì˜µë‹ˆë‹¤. (ì¤‘ë³µ ì—†ìŒ)
        </div>
        <div id="statusText" class="status"></div>
    </section>

    <!-- ê²°ê³¼ / ì…ì°° ì˜ì—­ -->
    <section class="panel">
        <div class="panel-title">
            ì¶”ì²¨ ê²°ê³¼ & ì…ì°°ê°€
            <span>ìœ„ì—ì„œ ë½‘íŒ ìˆœì„œëŒ€ë¡œ ê²½ë§¤ì— ì‚¬ìš©</span>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                <tr>
                    <th class="col-index">#</th>
                    <th class="col-name">ì´ë¦„</th>
                    <th class="col-lol-id">ë‹‰ë„¤ì„(ë¡¤ ì•„ì´ë””)</th>
                    <th class="col-tier">í‹°ì–´</th>
                    <th class="col-pos-main">ì£¼ í¬ì§€ì…˜</th>
                    <th class="col-pos-sub">ë¶€ í¬ì§€ì…˜</th>
                    <th class="col-attend">ì°¸ì„ë¥ </th>
                    <th class="col-bid">ì…ì°°ê°€</th>
                </tr>
                </thead>
                <tbody id="resultBody">
                <!-- JSì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
                </tbody>
            </table>
        </div>
    </section>

    <div class="footer">
        ì´ í˜ì´ì§€ëŠ” í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤. ì„œë²„/DB ì—†ì´ë„ ì‹¤í–‰ ê°€ëŠ¥ âœ¨
    </div>
</main>

<script>
    /**
     * ğŸ§¾ ì—‘ì…€ ì»¬ëŸ¼ ë§¤í•‘ ê·œì¹™ (Sheet1, 1í–‰ í—¤ë” ê¸°ì¤€)
     * ------------------------------------------------
     *   Aì—´: ì´ë¦„
     *   Bì—´: ë‹‰ë„¤ì„
     *   Cì—´: ìµœê³ í‹°ì–´
     *   Dì—´: í˜„ì¬ í‹°ì–´
     *   Eì—´: ì£¼í¬ì§€ì…˜
     *   Fì—´: ë¶€í¬ì§€ì…˜
     *   Gì—´: ì°¸ì„ë¥ 
     *
     *   ì´ë¦„    â†’ name
     *   ë‹‰ë„¤ì„  â†’ lolId
     *   í˜„ì¬ í‹°ì–´(ì—†ìœ¼ë©´ ìµœê³ í‹°ì–´) â†’ tier
     *   ì£¼í¬ì§€ì…˜ â†’ mainPos
     *   ë¶€í¬ì§€ì…˜ â†’ subPos
     *   ìµœê³ í‹°ì–´ â†’ maxTier (ë‚´ë¶€ ì €ì¥ìš©)
     *   ì°¸ì„ë¥    â†’ attend  (í…Œì´ë¸”ì—ë„ í‘œì‹œ)
     */

    // âœ… ì—‘ì…€ì—ì„œ ì½ì–´ì˜¨ ì¹œêµ¬ ë°ì´í„°ê°€ ë“¤ì–´ê°ˆ ë°°ì—´
    let friendsData = [];

    // í•œ ê²Œì„ì—ì„œ ë½‘ì„ ìµœëŒ€ ì¸ì› ìˆ˜ (ê²½ë§¤ ì¸ì› 30ëª…)
    const MAX_PICKS = 30;

    // DOM ìš”ì†Œë“¤
    const excelInput      = document.getElementById("excelInput");
    const pickButton      = document.getElementById("pickButton");
    const resetButton     = document.getElementById("resetButton");
    const resultBody      = document.getElementById("resultBody");
    const totalCountBadge = document.getElementById("totalCountBadge");
    const limitBadge      = document.getElementById("limitBadge");
    const statusText      = document.getElementById("statusText");

    // ìƒíƒœ ê´€ë¦¬ìš©
    let remainingFriends = [];  // ì•„ì§ ì•ˆ ë½‘íŒ ì¹œêµ¬ë“¤
    let pickedFriends    = [];  // ì´ë¯¸ ë½‘íŒ ì¹œêµ¬ë“¤ (ì…ì°°ê°€ í¬í•¨)

    /** ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ */
    function setStatus(message, type) {
        statusText.textContent = message || "";
        statusText.className = "status " + (type || "");
    }

    /** ìƒë‹¨ ë±ƒì§€ ì—…ë°ì´íŠ¸ */
    function updateTotalBadge() {
        totalCountBadge.textContent =
            `ì „ì²´ ì¹œêµ¬: ${friendsData.length}ëª… / ë‚¨ì€: ${remainingFriends.length}ëª…`;
    }

    /** ì¶”ì²¨ ê²°ê³¼ í…Œì´ë¸” ë Œë”ë§ */
    function renderResult() {
        resultBody.innerHTML = "";

        if (!pickedFriends || pickedFriends.length === 0) {
            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.colSpan = 8;  // ì»¬ëŸ¼ ìˆ˜ 8ê°œ (ì°¸ì„ë¥  í¬í•¨)
            td.textContent = "ì•„ì§ ë½‘íŒ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ëœë¤ ì¶”ì²¨ì„ ì‹œì‘í•˜ì„¸ìš”.";
            td.style.textAlign = "center";
            td.style.color = "#9ca3af";
            tr.appendChild(td);
            resultBody.appendChild(tr);
            return;
        }

        pickedFriends.forEach((f, idx) => {
            const tr = document.createElement("tr");

            const indexTd = document.createElement("td");
            indexTd.className = "col-index";
            indexTd.textContent = idx + 1;

            const nameTd = document.createElement("td");
            nameTd.className = "col-name";
            nameTd.textContent = f.name || "-";

            const lolTd = document.createElement("td");
            lolTd.className = "col-lol-id";
            lolTd.textContent = f.lolId || "-";

            const tierTd = document.createElement("td");
            tierTd.className = "col-tier";
            tierTd.textContent = f.tier || "-";

            const mainTd = document.createElement("td");
            mainTd.className = "col-pos-main";
            mainTd.textContent = f.mainPos || "-";

            const subTd = document.createElement("td");
            subTd.className = "col-pos-sub";
            subTd.textContent = f.subPos || "-";

            const attendTd = document.createElement("td");
            attendTd.className = "col-attend";
            attendTd.textContent = f.attend || "-";

            const bidTd = document.createElement("td");
            bidTd.className = "col-bid";
            const bidInput = document.createElement("input");
            bidInput.type = "number";
            bidInput.min = "0";
            bidInput.placeholder = "ì…ì°°ê°€";
            bidInput.className = "bid-input";
            bidInput.value = f.bid != null ? f.bid : "";
            bidInput.dataset.index = idx.toString();

            // ì…ì°°ê°€ ì…ë ¥ â†’ pickedFriends ë‚´ë¶€ ìƒíƒœì—ë„ ë°˜ì˜
            bidInput.addEventListener("input", (e) => {
                const i = Number(e.target.dataset.index);
                pickedFriends[i].bid = e.target.value;
            });

            bidTd.appendChild(bidInput);

            tr.appendChild(indexTd);
            tr.appendChild(nameTd);
            tr.appendChild(lolTd);
            tr.appendChild(tierTd);
            tr.appendChild(mainTd);
            tr.appendChild(subTd);
            tr.appendChild(attendTd);
            tr.appendChild(bidTd);

            resultBody.appendChild(tr);
        });
    }

    /** ì „ì²´ ìƒíƒœ ì´ˆê¸°í™” (friendsData ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ì…‹íŒ…) */
    function initState() {
        remainingFriends = [...friendsData];
        pickedFriends = [];

        const maxPicks = Math.min(MAX_PICKS, friendsData.length);
        limitBadge.textContent = `ìµœëŒ€ ${maxPicks}ëª…ê¹Œì§€ ì¶”ì²¨`;

        updateTotalBadge();
        renderResult();

        if (friendsData.length === 0) {
            setStatus("ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì„œ ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.", "warn");
            pickButton.disabled = true;
        } else {
            setStatus("ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹œêµ¬ë¥¼ ëœë¤ìœ¼ë¡œ í•œ ëª…ì”© ë½‘ìœ¼ì„¸ìš”.", "");
            pickButton.disabled = false;
        }
    }

    /** ì—‘ì…€ íŒŒì¼ ì„ íƒ ì‹œ í˜¸ì¶œ */
    function handleExcelFile(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();

        reader.onload = (evt) => {
            try {
                const data = new Uint8Array(evt.target.result);
                const workbook = XLSX.read(data, { type: "array" });

                // sheet1 = ì²« ë²ˆì§¸ ì‹œíŠ¸ ì‚¬ìš©
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                // header:1 â†’ [[í—¤ë”1, í—¤ë”2,...], [row1...], [row2...], ...]
                const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                if (!rows || rows.length < 2) {
                    setStatus("ì—‘ì…€ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (í—¤ë” + í•œ ì¤„ ì´ìƒ í•„ìš”)", "error");
                    return;
                }

                const header = rows[0].map(h => (h || "").toString().trim());

                // í—¤ë” ì¸ë±ìŠ¤ ì°¾ê¸°
                const idxName     = header.indexOf("ì´ë¦„");
                const idxNick     = header.indexOf("ë‹‰ë„¤ì„");
                const idxMaxTier  = header.indexOf("ìµœê³ í‹°ì–´");
                const idxCurrTier = header.indexOf("í˜„ì¬ í‹°ì–´");
                const idxMainPos  = header.indexOf("ì£¼í¬ì§€ì…˜");
                const idxSubPos   = header.indexOf("ë¶€í¬ì§€ì…˜");
                const idxAttend   = header.indexOf("ì°¸ì„ë¥ ");

                // í•„ìˆ˜ ì»¬ëŸ¼ ì²´í¬
                if (idxName === -1 || idxNick === -1 || idxMainPos === -1 || idxSubPos === -1) {
                    setStatus(
                        "ì—‘ì…€ ì²« ì¤„ì— 'ì´ë¦„ / ë‹‰ë„¤ì„ / ìµœê³ í‹°ì–´ / í˜„ì¬ í‹°ì–´ / ì£¼í¬ì§€ì…˜ / ë¶€í¬ì§€ì…˜ / ì°¸ì„ë¥ ' í—¤ë”ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.",
                        "error"
                    );
                    return;
                }

                const dataRows = rows.slice(1); // í—¤ë” ì œì™¸

                const parsed = dataRows
                    .map((row) => {
                        if (!row || row.length === 0) return null;

                        const name     = (row[idxName]     || "").toString().trim();
                        const nick     = (row[idxNick]     || "").toString().trim();
                        const maxTier  = idxMaxTier  !== -1 ? (row[idxMaxTier]  || "").toString().trim() : "";
                        const currTier = idxCurrTier !== -1 ? (row[idxCurrTier] || "").toString().trim() : "";
                        const mainPos  = (row[idxMainPos]  || "").toString().trim();
                        const subPos   = (row[idxSubPos]   || "").toString().trim();
                        const attend   = idxAttend   !== -1 ? (row[idxAttend]   || "").toString().trim() : "";

                        // ì´ë¦„/ë‹‰ë„¤ì„ ë‘˜ ë‹¤ ë¹„ì–´ ìˆìœ¼ë©´ ìŠ¤í‚µ
                        if (!name && !nick) return null;

                        return {
                            name,
                            lolId: nick,
                            tier: currTier || maxTier, // í˜„ì¬ í‹°ì–´ ìš°ì„ , ì—†ìœ¼ë©´ ìµœê³ í‹°ì–´
                            mainPos,
                            subPos,
                            maxTier,
                            attend
                        };
                    })
                    .filter(Boolean);

                friendsData = parsed;
                initState();  // ìƒˆ ë°ì´í„°ë¡œ ìƒíƒœ ì´ˆê¸°í™”

                if (friendsData.length === 0) {
                    setStatus("ì—‘ì…€ì—ì„œ ìœ íš¨í•œ ì¹œêµ¬ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", "error");
                } else {
                    setStatus(
                        `ì—‘ì…€ì—ì„œ ì¹œêµ¬ ${friendsData.length}ëª…ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ì´ì œ ëœë¤ ë½‘ê¸°ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                        "ok"
                    );
                }
            } catch (err) {
                console.error(err);
                setStatus("ì—‘ì…€ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
            }
        };

        reader.readAsArrayBuffer(file);
    }

    /** ëœë¤ìœ¼ë¡œ í•œ ëª… ë½‘ê¸° (ë‚¨ì€ ì‚¬ëŒ ì¤‘ì—ì„œë§Œ, ì¤‘ë³µ X) */
    function handlePick() {
        if (friendsData.length === 0) {
            setStatus("ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì„œ ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.", "error");
            return;
        }

        const maxPicks = Math.min(MAX_PICKS, friendsData.length);

        // ì´ë¯¸ ìµœëŒ€ ì¸ì›ê¹Œì§€ ë½‘ì•˜ë‹¤ë©´
        if (pickedFriends.length >= maxPicks) {
            setStatus(
                `ì´ë¯¸ ìµœëŒ€ ${maxPicks}ëª…ì„ ë½‘ì•˜ìŠµë‹ˆë‹¤. ë” ë½‘ìœ¼ë ¤ë©´ 'ì „ì²´ ì´ˆê¸°í™”' í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.`,
                "warn"
            );
            pickButton.disabled = true;
            return;
        }

        // ë‚¨ì€ ì‚¬ëŒì´ ì—†ìœ¼ë©´
        if (remainingFriends.length === 0) {
            setStatus(
                "ë½‘ì„ ìˆ˜ ìˆëŠ” ì¹œêµ¬ê°€ ë” ì´ìƒ ì—†ìŠµë‹ˆë‹¤. 'ì „ì²´ ì´ˆê¸°í™”' í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.",
                "warn"
            );
            pickButton.disabled = true;
            return;
        }

        // ë‚¨ì€ ì¹œêµ¬ë“¤ ì¤‘ì—ì„œ 1ëª… ëœë¤ ë½‘ê¸° (without replacement)
        const idx = Math.floor(Math.random() * remainingFriends.length);
        const [picked] = remainingFriends.splice(idx, 1);  // remainingì—ì„œ ì œê±°
        pickedFriends.push({ ...picked, bid: picked.bid ?? "" });

        updateTotalBadge();
        renderResult();

        setStatus(`"${picked.name || picked.lolId}" ë‹˜ì´ ë½‘í˜”ìŠµë‹ˆë‹¤.`, "ok");

        if (pickedFriends.length >= maxPicks || remainingFriends.length === 0) {
            pickButton.disabled = true;
            if (remainingFriends.length === 0) {
                setStatus(
                    `ëª¨ë“  ì¹œêµ¬ë¥¼ ë‹¤ ë½‘ì•˜ìŠµë‹ˆë‹¤. (ì´ ${pickedFriends.length}ëª…)`,
                    "ok"
                );
            } else {
                setStatus(
                    `ìµœëŒ€ ${maxPicks}ëª…ì„ ëª¨ë‘ ë½‘ì•˜ìŠµë‹ˆë‹¤.`,
                    "ok"
                );
            }
        }
    }

    /** ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ */
    function handleReset() {
        initState();
        setStatus("ì „ì²´ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì—‘ì…€ì€ ê·¸ëŒ€ë¡œì´ê³ , ì¶”ì²¨ë§Œ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.", "");
    }

    // ==== ì´ˆê¸° ì´ë²¤íŠ¸ ë°”ì¸ë”© & ê¸°ë³¸ ìƒíƒœ ì„¤ì • ====
    excelInput.addEventListener("change", handleExcelFile);
    pickButton.addEventListener("click", handlePick);
    resetButton.addEventListener("click", handleReset);

    // ì²˜ìŒ í˜ì´ì§€ ì—´ë ¸ì„ ë•Œ ìƒíƒœ
    initState();
</script>
</body>
</html>
