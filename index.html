<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ë¡¤ ì¹œêµ¬ ê²½ë§¤ - ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° & 4ì¸ ê²½ë§¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ì—‘ì…€(xlsx) íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        * { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                sans-serif;
            margin: 0;
            padding: 0;
            background: #0f172a;
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            padding: 16px 24px;
            background: linear-gradient(90deg, #111827, #1f2937);
            border-bottom: 1px solid #1f2937;
        }

        header h1 {
            margin: 0;
            font-size: 1.4rem;
        }

        header p {
            margin: 4px 0 0;
            font-size: 0.85rem;
            color: #9ca3af;
        }

        main {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 16px;
        }

        .panel {
            background: #020617;
            border-radius: 10px;
            padding: 16px 18px;
            border: 1px solid #1e293b;
            margin-bottom: 16px;
        }

        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title span {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 400;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: #1f2937;
            color: #9ca3af;
            border: 1px solid #374151;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }

        button {
            border: none;
            border-radius: 999px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            background: #3b82f6;
            color: white;
            font-weight: 600;
            transition: transform 0.05s ease-out, box-shadow 0.05s ease-out,
                background 0.2s ease-out;
        }

        button:hover {
            background: #2563eb;
            box-shadow: 0 0 0 1px #1d4ed8;
        }

        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: #4b5563;
        }

        .btn-secondary:hover {
            background: #374151;
            box-shadow: 0 0 0 1px #111827;
        }

        .file-input {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
        }

        .info-text {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .info-text strong {
            color: #e5e7eb;
        }

        .status {
            margin-top: 6px;
            font-size: 0.8rem;
        }

        .status.ok { color: #22c55e; }
        .status.warn { color: #facc15; }
        .status.error { color: #f97373; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 8px;
        }

        thead { background: #020617; }

        th, td {
            padding: 8px 6px;
            border-bottom: 1px solid #1f2937;
            text-align: center;
            white-space: nowrap;
        }

        th {
            font-weight: 600;
            color: #9ca3af;
            position: sticky;
            top: 0;
            background: #020617;
            z-index: 1;
        }

        tbody tr:nth-child(even) { background: #020617; }
        tbody tr:nth-child(odd)  { background: #020617; }
        tbody tr:hover           { background: #0b1120; }

        .col-index  { width: 40px; }
        .col-name   { width: 110px; }
        .col-nick   { width: 160px; }
        .col-tier   { width: 90px; }
        .col-pos    { width: 80px; }
        .col-attend { width: 80px; }

        .table-wrapper {
            max-height: 55vh;
            overflow: auto;
            border-radius: 8px;
            border: 1px solid #1f2937;
            margin-top: 8px;
        }

        .layout-two-cols {
            display: grid;
            grid-template-columns: 1.2fr 1.3fr;
            gap: 16px;
        }

        @media (max-width: 900px) {
            .layout-two-cols {
                grid-template-columns: 1fr;
            }
        }

        .auction-current {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 12px;
        }

        @media (max-width: 700px) {
            .auction-current {
                grid-template-columns: 1fr;
            }
        }

        .auction-box {
            border-radius: 8px;
            border: 1px solid #1f2937;
            padding: 10px 12px;
            background: #020617;
        }

        .auction-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .auction-info-row {
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .auction-info-label {
            color: #9ca3af;
            margin-right: 4px;
        }

        .bidders-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 8px;
        }

        @media (max-width: 700px) {
            .bidders-grid {
                grid-template-columns: 1fr;
            }
        }

        .bidder-card {
            border-radius: 8px;
            border: 1px solid #1f2937;
            padding: 8px 10px;
            background: #020617;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .bidder-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .bidder-name {
            font-weight: 600;
        }

        .bidder-coins {
            font-size: 0.8rem;
            color: #a5b4fc;
        }

        .bidder-btn-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .bidder-btn-row button {
            flex: 1;
            padding: 6px 10px;
            font-size: 0.8rem;
        }

        .bidder-status {
            font-size: 0.78rem;
            color: #9ca3af;
        }

        /* ë‚™ì°° ê²°ê³¼ / í¬ì§€ì…˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ìš© */
        .result-list {
            margin-top: 4px;
            font-size: 0.8rem;
            padding-left: 12px;
            max-height: 140px;
            overflow-y: auto;
        }

        .result-list li {
            margin-bottom: 2px;
        }

        .result-empty {
            font-size: 0.78rem;
            color: #9ca3af;
        }

        .footer {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
            padding: 8px 0 16px;
        }
    </style>
</head>
<body>
<header>
    <h1>MAPLE APEC</h1>
    <p>Winter ì‹œì¦Œ íŒ€ ê²°ì •ì „</p>
</header>

<main>
    <!-- ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° / ì „ì²´ ìƒíƒœ -->
    <section class="panel">
        <div class="panel-title">
            ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸° & ê¸°ë³¸ ì„¤ì •
            <span>Sheet1 ì²« ì¤„: ì´ë¦„ / ë‹‰ë„¤ì„ / ìµœê³ í‹°ì–´ / í˜„ì¬ í‹°ì–´ / ì£¼í¬ì§€ì…˜ / ë¶€í¬ì§€ì…˜ / ì°¸ì„ë¥ </span>
        </div>

        <div class="controls">
            <input
                type="file"
                id="excelInput"
                accept=".xlsx,.xls"
                class="file-input"
            />

            <button id="randomFriendButton">ëœë¤ìœ¼ë¡œ ë‹¤ìŒ ì¹œêµ¬ ì„ íƒ</button>
            <button id="resetAllButton" class="btn-secondary">ì „ì²´ ì´ˆê¸°í™”</button>

            <div class="badge" id="totalCountBadge">
                ì „ì²´ ì¹œêµ¬: 0ëª… / ë‚¨ì€: 0ëª…
            </div>
        </div>

        <div class="info-text" style="margin-top: 6px;">
            â€¢ ì—‘ì…€ì—ì„œ ì¹œêµ¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ ë’¤, <strong>â€œëœë¤ìœ¼ë¡œ ë‹¤ìŒ ì¹œêµ¬ ì„ íƒâ€</strong>ì„ ëˆŒëŸ¬ ê²½ë§¤í•  ì¹œêµ¬ë¥¼ ê³ ë¦…ë‹ˆë‹¤.<br />
            â€¢ ì„ íƒëœ ì¹œêµ¬ëŠ” ë‚¨ì€ ëª©ë¡ì—ì„œ ì œê±°ë˜ë©°, 4ëª…ì´ <strong>+1 ì½”ì¸</strong>ì”© ë²„íŠ¼ìœ¼ë¡œ ì…ì°°í•©ë‹ˆë‹¤.<br />
            â€¢ <strong>ë‚™ì°°</strong> ì‹œ, ìµœê³  ì…ì°°ìì˜ ì½”ì¸ì—ì„œ ê°€ê²©ë§Œí¼ ì°¨ê°ë˜ê³  ì•„ë˜ ë‚™ì°° ê²°ê³¼ / í¬ì§€ì…˜ ê²°ê³¼ì— ë°˜ì˜ë©ë‹ˆë‹¤.
        </div>
        <div id="statusText" class="status"></div>
    </section>

    <!-- ë‚¨ì€ ì¹œêµ¬ / ê²½ë§¤ ì˜ì—­ 2ë‹¨ ë ˆì´ì•„ì›ƒ -->
    <section class="layout-two-cols">
        <!-- ë‚¨ì€ ì¹œêµ¬ ëª©ë¡ -->
        <section class="panel">
            <div class="panel-title">
                ë‚¨ì€ ì¹œêµ¬ ëª©ë¡
                <span>ì—‘ì…€ ìˆœì„œëŒ€ë¡œ í‘œì‹œ, ì´ ì¤‘ì—ì„œ ëœë¤ìœ¼ë¡œ ê²½ë§¤ ëŒ€ìƒ ì„ íƒ</span>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                    <tr>
                        <th class="col-index">#</th>
                        <th class="col-name">ì´ë¦„</th>
                        <th class="col-nick">ë‹‰ë„¤ì„</th>
                        <th class="col-tier">í‹°ì–´</th>
                        <th class="col-pos">ì£¼í¬ì§€</th>
                        <th class="col-pos">ë¶€í¬ì§€</th>
                        <th class="col-attend">ì°¸ì„ë¥ </th>
                    </tr>
                    </thead>
                    <tbody id="remainingBody">
                    <!-- JSì—ì„œ ì±„ì›€ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ê²½ë§¤ ì˜ì—­ -->
        <section class="panel">
            <div class="panel-title">
                ê²½ë§¤ ì§„í–‰
                <span>í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ & 4ì¸ ì…ì°°</span>
            </div>

            <div class="auction-current">
                <!-- í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ ì •ë³´ -->
                <div class="auction-box">
                    <div class="auction-title">í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬</div>
                    <div id="currentFriendInfo">
                        <div class="auction-info-row">ì•„ì§ ì„ íƒëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                    <hr style="border-color:#1f2937; margin:8px 0;">
                    <div class="auction-info-row">
                        <span class="auction-info-label">í˜„ì¬ ê°€ê²©:</span>
                        <span id="currentPrice">0</span> ì½”ì¸
                    </div>
                    <div class="auction-info-row">
                        <span class="auction-info-label">ìµœê³  ì…ì°°ì:</span>
                        <span id="currentLeader">ì—†ìŒ</span>
                    </div>
                    <div style="margin-top:8px; display:flex; gap:8px;">
                        <button id="finishAuctionButton">ë‚™ì°°</button>
                        <button id="skipAuctionButton" class="btn-secondary">ìœ ì°°</button>
                    </div>
                </div>

                <!-- 4ì¸ ì…ì°° -->
                <div class="auction-box">
                    <div class="auction-title">ê²½ë§¤ì (ê° 100ì½”ì¸ ì‹œì‘)</div>
                    <div class="bidders-grid" id="biddersGrid">
                        <!-- JSì—ì„œ ì¹´ë“œ ìƒì„± -->
                    </div>
                </div>
            </div>
        </section>
    </section>

    <!-- ë„¤ ì‚¬ëŒì˜ ë‚™ì°° ê²°ê³¼ ì˜ì—­ -->
    <section class="panel">
        <div class="panel-title">
            ë‚™ì°° ê²°ê³¼ ìš”ì•½
            <span>ê° ê²½ë§¤ìê°€ ë°ë ¤ê°„ ì¹œêµ¬ì™€ ë‚™ì°°ê°€</span>
        </div>

        <div class="bidders-grid">
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ê¹€í˜•ê³¤</span>
                </div>
                <div id="result_kim_hg"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ê¹€ë´‰ì„­</span>
                </div>
                <div id="result_kim_bs"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ë°•ë¬¸ê·œ</span>
                </div>
                <div id="result_park_mk"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ì´ì¬ê´‘</span>
                </div>
                <div id="result_lee_jg"></div>
            </div>
        </div>
    </section>

    <!-- ğŸ”¥ íŒ€ë³„ í¬ì§€ì…˜ë³„ ë‚™ì°° ì¸ì› ì˜ì—­ -->
    <section class="panel">
        <div class="panel-title">
            íŒ€ë³„ í¬ì§€ì…˜ë³„ ë‚™ì°° ì¸ì›
            <span>ê° íŒ€ì—ì„œ í¬ì§€ì…˜ë³„ë¡œ ëˆ„ê°€ ìˆëŠ”ì§€</span>
        </div>

        <div class="bidders-grid">
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ê¹€í˜•ê³¤ íŒ€ í¬ì§€ì…˜</span>
                </div>
                <div id="pos_kim_hg"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ê¹€ë´‰ì„­ íŒ€ í¬ì§€ì…˜</span>
                </div>
                <div id="pos_kim_bs"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ë°•ë¬¸ê·œ íŒ€ í¬ì§€ì…˜</span>
                </div>
                <div id="pos_park_mk"></div>
            </div>
            <div class="bidder-card">
                <div class="bidder-header">
                    <span class="bidder-name">ì´ì¬ê´‘ íŒ€ í¬ì§€ì…˜</span>
                </div>
                <div id="pos_lee_jg"></div>
            </div>
        </div>
    </section>

    <div class="footer">
        ì´ í˜ì´ì§€ëŠ” ë¸Œë¼ìš°ì €ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤. ì„œë²„/DB ì—†ì´ ì‚¬ìš© ê°€ëŠ¥ âœ¨
    </div>
</main>

<script>
    /**
     * ğŸ§¾ ì—‘ì…€ ì»¬ëŸ¼ ë§¤í•‘ ê·œì¹™ (Sheet1, ì²« í–‰ í—¤ë” ê¸°ì¤€)
     * ------------------------------------------------
     *   Aì—´: ì´ë¦„
     *   Bì—´: ë‹‰ë„¤ì„
     *   Cì—´: ìµœê³ í‹°ì–´
     *   Dì—´: í˜„ì¬ í‹°ì–´
     *   Eì—´: ì£¼í¬ì§€ì…˜
     *   Fì—´: ë¶€í¬ì§€ì…˜
     *   Gì—´: ì°¸ì„ë¥ 
     *
     *   ì´ë¦„    â†’ name
     *   ë‹‰ë„¤ì„  â†’ nick
     *   í˜„ì¬ í‹°ì–´(ì—†ìœ¼ë©´ ìµœê³ í‹°ì–´) â†’ tier
     *   ì£¼í¬ì§€ì…˜ â†’ mainPos
     *   ë¶€í¬ì§€ì…˜ â†’ subPos
     *   ìµœê³ í‹°ì–´ â†’ maxTier (ë‚´ë¶€ ë³´ê´€)
     *   ì°¸ì„ë¥    â†’ attend
     */

    // ì—‘ì…€ì—ì„œ ì½ì–´ì˜¨ ì „ì²´ ì¹œêµ¬
    let friendsData = [];

    // ì•„ì§ ê²½ë§¤ ì•ˆí•œ ì¹œêµ¬ (ì—‘ì…€ ìˆœì„œ ìœ ì§€)
    let remainingFriends = [];

    // ë‚™ì°°ëœ ì¹œêµ¬ ëª©ë¡ {friend, winnerId, winnerName, price}
    let auctionResults = [];

    // í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ & ê°€ê²© ìƒíƒœ
    let currentFriend = null;
    let currentPrice = 0;
    let currentLeaderId = null; // bidder id

    // ê²½ë§¤ì 4ëª… (ì´ë¦„/ì´ˆê¸°ì½”ì¸)
    const initialCoins = 100;
    const bidders = [
        { id: "kim_hg", name: "ê¹€í˜•ê³¤", coins: initialCoins },
        { id: "kim_bs", name: "ê¹€ë´‰ì„­", coins: initialCoins },
        { id: "park_mk", name: "ë°•ë¬¸ê·œ", coins: initialCoins },
        { id: "lee_jg", name: "ì´ì¬ê´‘", coins: initialCoins }
    ];

    // DOM ì°¸ì¡°
    const excelInput          = document.getElementById("excelInput");
    const randomFriendButton  = document.getElementById("randomFriendButton");
    const resetAllButton      = document.getElementById("resetAllButton");
    const statusText          = document.getElementById("statusText");
    const totalCountBadge     = document.getElementById("totalCountBadge");
    const remainingBody       = document.getElementById("remainingBody");
    const currentFriendInfo   = document.getElementById("currentFriendInfo");
    const currentPriceSpan    = document.getElementById("currentPrice");
    const currentLeaderSpan   = document.getElementById("currentLeader");
    const finishAuctionButton = document.getElementById("finishAuctionButton");
    const skipAuctionButton   = document.getElementById("skipAuctionButton");
    const biddersGrid         = document.getElementById("biddersGrid");

    // ìƒíƒœ ì¶œë ¥
    function setStatus(msg, type) {
        statusText.textContent = msg || "";
        statusText.className = "status " + (type || "");
    }

    // ë‚¨ì€ ì¸ì› ë±ƒì§€
    function updateTotalBadge() {
        totalCountBadge.textContent =
            `ì „ì²´ ì¹œêµ¬: ${friendsData.length}ëª… / ë‚¨ì€: ${remainingFriends.length}ëª…`;
    }

    // ë‚¨ì€ ì¹œêµ¬ í…Œì´ë¸” ë Œë”ë§
    function renderRemainingFriends() {
        remainingBody.innerHTML = "";

        if (remainingFriends.length === 0) {
            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.colSpan = 7;
            td.textContent = "ë‚¨ì€ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.";
            td.style.textAlign = "center";
            td.style.color = "#9ca3af";
            tr.appendChild(td);
            remainingBody.appendChild(tr);
            return;
        }

        remainingFriends.forEach((f, idx) => {
            const tr = document.createElement("tr");

            const tdIndex = document.createElement("td");
            tdIndex.className = "col-index";
            tdIndex.textContent = idx + 1;

            const tdName = document.createElement("td");
            tdName.className = "col-name";
            tdName.textContent = f.name || "-";

            const tdNick = document.createElement("td");
            tdNick.className = "col-nick";
            tdNick.textContent = f.nick || "-";

            const tdTier = document.createElement("td");
            tdTier.className = "col-tier";
            tdTier.textContent = f.tier || "-";

            const tdMain = document.createElement("td");
            tdMain.className = "col-pos";
            tdMain.textContent = f.mainPos || "-";

            const tdSub = document.createElement("td");
            tdSub.className = "col-pos";
            tdSub.textContent = f.subPos || "-";

            const tdAttend = document.createElement("td");
            tdAttend.className = "col-attend";
            tdAttend.textContent = f.attend || "-";

            tr.appendChild(tdIndex);
            tr.appendChild(tdName);
            tr.appendChild(tdNick);
            tr.appendChild(tdTier);
            tr.appendChild(tdMain);
            tr.appendChild(tdSub);
            tr.appendChild(tdAttend);

            remainingBody.appendChild(tr);
        });
    }

    // í˜„ì¬ ì¹œêµ¬ ì •ë³´ ë Œë”ë§
    function renderCurrentFriend() {
        currentFriendInfo.innerHTML = "";

        if (!currentFriend) {
            const div = document.createElement("div");
            div.className = "auction-info-row";
            div.textContent = "ì•„ì§ ì„ íƒëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì—ì„œ 'ëœë¤ìœ¼ë¡œ ë‹¤ìŒ ì¹œêµ¬ ì„ íƒ'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
            currentFriendInfo.appendChild(div);
            currentPriceSpan.textContent = "0";
            currentLeaderSpan.textContent = "ì—†ìŒ";
            return;
        }

        const infoRows = [
            ["ì´ë¦„", currentFriend.name || "-"],
            ["ë‹‰ë„¤ì„", currentFriend.nick || "-"],
            ["í‹°ì–´", currentFriend.tier || "-"],
            ["ì£¼ í¬ì§€ì…˜", currentFriend.mainPos || "-"],
            ["ë¶€ í¬ì§€ì…˜", currentFriend.subPos || "-"],
            ["ì°¸ì„ë¥ ", currentFriend.attend || "-"]
        ];

        infoRows.forEach(([label, value]) => {
            const rowDiv = document.createElement("div");
            rowDiv.className = "auction-info-row";

            const spanLabel = document.createElement("span");
            spanLabel.className = "auction-info-label";
            spanLabel.textContent = label + ":";

            const spanVal = document.createElement("span");
            spanVal.textContent = value;

            rowDiv.appendChild(spanLabel);
            rowDiv.appendChild(spanVal);
            currentFriendInfo.appendChild(rowDiv);
        });

        currentPriceSpan.textContent = currentPrice.toString();
        if (!currentLeaderId) {
            currentLeaderSpan.textContent = "ì—†ìŒ";
        } else {
            const leader = bidders.find(b => b.id === currentLeaderId);
            currentLeaderSpan.textContent = leader ? leader.name : "ì•Œ ìˆ˜ ì—†ìŒ";
        }
    }

    // ê²½ë§¤ì(4ëª…) ì¹´ë“œ ë Œë”ë§ (ìœ„ìª½ ì…ì°° ë°•ìŠ¤)
    function renderBidders() {
        biddersGrid.innerHTML = "";

        bidders.forEach((b) => {
            const card = document.createElement("div");
            card.className = "bidder-card";

            const header = document.createElement("div");
            header.className = "bidder-header";

            const nameSpan = document.createElement("span");
            nameSpan.className = "bidder-name";
            nameSpan.textContent = b.name;

            const coinsSpan = document.createElement("span");
            coinsSpan.className = "bidder-coins";
            coinsSpan.id = `coins_${b.id}`;
            coinsSpan.textContent = `${b.coins} ì½”ì¸`;

            header.appendChild(nameSpan);
            header.appendChild(coinsSpan);

            const btnRow = document.createElement("div");
            btnRow.className = "bidder-btn-row";

            const bidBtn = document.createElement("button");
            bidBtn.textContent = "+1 ì…ì°°";
            bidBtn.id = `bid_${b.id}`;

            bidBtn.addEventListener("click", () => handleBid(b.id));

            const statusSpan = document.createElement("span");
            statusSpan.className = "bidder-status";
            statusSpan.id = `status_${b.id}`;
            statusSpan.textContent = "";

            btnRow.appendChild(bidBtn);
            btnRow.appendChild(statusSpan);

            card.appendChild(header);
            card.appendChild(btnRow);

            biddersGrid.appendChild(card);

            updateBidderButtonState(b.id);
        });

        // ì•„ë˜ ë‚™ì°° ê²°ê³¼ & í¬ì§€ì…˜ ê²°ê³¼ë„ ê°™ì´ ê°±ì‹ 
        renderResults();
    }

    // ì…ì°°ì ì½”ì¸/ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateBidderButtonState(bidderId) {
        const bidder = bidders.find(b => b.id === bidderId);
        if (!bidder) return;

        const btn   = document.getElementById(`bid_${bidderId}`);
        const coinsSpan = document.getElementById(`coins_${bidderId}`);
        const statusSpan = document.getElementById(`status_${bidderId}`);

        if (coinsSpan) {
            coinsSpan.textContent = `${bidder.coins} ì½”ì¸`;
        }

        if (!currentFriend) {
            if (btn) btn.disabled = true;
            if (statusSpan) statusSpan.textContent = "ê²½ë§¤ ëŒ€ìƒ ì—†ìŒ";
            return;
        }

        // í˜„ì¬ ê°€ê²©ë³´ë‹¤ í° ê¸ˆì•¡ìœ¼ë¡œ ì…ì°°í•  ìˆ˜ ìˆì–´ì•¼ í•¨
        if (bidder.coins <= currentPrice) {
            if (btn) btn.disabled = true;
            if (statusSpan) statusSpan.textContent = "ì½”ì¸ ë¶€ì¡±";
        } else {
            if (btn) btn.disabled = false;
            if (statusSpan) statusSpan.textContent = "";
        }
    }

    // ëª¨ë“  ê²½ë§¤ì ë²„íŠ¼ ìƒíƒœ ë¦¬í”„ë ˆì‹œ
    function refreshAllBidderButtons() {
        bidders.forEach(b => updateBidderButtonState(b.id));
    }

    // ğŸ”§ í¬ì§€ì…˜ ë¬¸ìì—´ ì •ê·œí™” (íƒ‘/ì •ê¸€/ë¯¸ë“œ/ì›ë”œ/ì„œí¿ìœ¼ë¡œ ë§ì¶”ê¸°)
    function normalizePosition(pos) {
        if (!pos) return null;
        const p = pos.toString().trim().toLowerCase();

        if (!p) return null;

        if (p.includes("íƒ‘") || p === "top") return "íƒ‘";
        if (p.includes("ì •ê¸€") || p === "jungle" || p === "jg") return "ì •ê¸€";
        if (p.includes("ë¯¸ë“œ") || p === "mid") return "ë¯¸ë“œ";
        if (p.includes("ì›ë”œ") || p === "adc" || p === "ad" || p === "bot") return "ì›ë”œ";
        if (p.includes("ì„œí¿") || p.includes("ì„œí¬íŠ¸") || p === "sup" || p === "support") return "ì„œí¿";

        return null;
    }

    // ğŸ”¥ ë‚™ì°° ê²°ê³¼: ë„¤ ì‚¬ëŒë³„ ì´ë¦„ + ê°€ê²©, ê·¸ë¦¬ê³  íŒ€ë³„ í¬ì§€ì…˜ ê²°ê³¼ê¹Œì§€
    function renderResults() {
        // --- 1) ë„¤ ì‚¬ëŒë³„ ë‚™ì°° ê²°ê³¼ (ì´ë¦„ + ê°€ê²©) ---
        bidders.forEach(b => {
            const container = document.getElementById(`result_${b.id}`);
            if (!container) return;

            container.innerHTML = "";
            const myWins = auctionResults.filter(r => r.winnerId === b.id);

            if (myWins.length === 0) {
                const empty = document.createElement("div");
                empty.className = "result-empty";
                empty.textContent = "ì•„ì§ ë‚™ì°°í•œ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.";
                container.appendChild(empty);
                return;
            }

            const ul = document.createElement("ul");
            ul.className = "result-list";

            myWins.forEach(r => {
                const li = document.createElement("li");
                const friendName = r.friend.name || r.friend.nick || "-";
                li.textContent = `${friendName} - ${r.price}ì½”ì¸`;
                ul.appendChild(li);
            });

            container.appendChild(ul);
        });

        // --- 2) íŒ€ë³„ í¬ì§€ì…˜ë³„ ë‚™ì°° ê²°ê³¼ ---
        renderPositionResults();
    }

    // íŒ€ë³„ í¬ì§€ì…˜ë³„ ë‚™ì°° ê²°ê³¼ ë Œë”ë§
    function renderPositionResults() {
        const roleKeys = ["íƒ‘", "ì •ê¸€", "ë¯¸ë“œ", "ì›ë”œ", "ì„œí¿"];

        bidders.forEach(b => {
            const container = document.getElementById(`pos_${b.id}`);
            if (!container) return;

            container.innerHTML = "";

            const myWins = auctionResults.filter(r => r.winnerId === b.id);

            if (myWins.length === 0) {
                const empty = document.createElement("div");
                empty.className = "result-empty";
                empty.textContent = "ì•„ì§ ë‚™ì°° ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤.";
                container.appendChild(empty);
                return;
            }

            // í¬ì§€ì…˜ë³„ë¡œ ë°°ì—´ ë§Œë“¤ê¸°
            const posPlayers = {
                "íƒ‘":   [],
                "ì •ê¸€": [],
                "ë¯¸ë“œ": [],
                "ì›ë”œ": [],
                "ì„œí¿": []
            };

            myWins.forEach(r => {
                const name = r.friend.name || r.friend.nick || "-";
                const main = normalizePosition(r.friend.mainPos);
                const sub  = normalizePosition(r.friend.subPos);

                if (main && posPlayers[main]) posPlayers[main].push(name);
                if (sub  && posPlayers[sub])  posPlayers[sub].push(name);
            });

            const ul = document.createElement("ul");
            ul.className = "result-list";

            roleKeys.forEach(role => {
                const li = document.createElement("li");
                const list = posPlayers[role];
                if (!list || list.length === 0) {
                    li.textContent = `${role}: -`;
                } else {
                    li.textContent = `${role}: ${list.join(", ")}`;
                }
                ul.appendChild(li);
            });

            container.appendChild(ul);
        });
    }

    // ì „ì²´ ì´ˆê¸°í™” (ì—‘ì…€ ë°ì´í„°ëŠ” ìœ ì§€)
    function resetAllState() {
        remainingFriends = [...friendsData];
        auctionResults = [];
        currentFriend = null;
        currentPrice = 0;
        currentLeaderId = null;

        // ê²½ë§¤ì ì½”ì¸ ì´ˆê¸°í™”
        bidders.forEach(b => {
            b.coins = initialCoins;
        });

        updateTotalBadge();
        renderRemainingFriends();
        renderCurrentFriend();
        renderBidders(); // ë‚´ë¶€ì—ì„œ renderResults -> renderPositionResults í˜¸ì¶œ

        setStatus(
            friendsData.length === 0
                ? "ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì„œ ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”."
                : "ì „ì²´ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ëœë¤ìœ¼ë¡œ ì¹œêµ¬ë¥¼ ì„ íƒí•´ì„œ ê²½ë§¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”.",
            friendsData.length === 0 ? "warn" : ""
        );
    }

    // ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬
    function handleExcelFile(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();

        reader.onload = (evt) => {
            try {
                const data = new Uint8Array(evt.target.result);
                const workbook = XLSX.read(data, { type: "array" });

                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                if (!rows || rows.length < 2) {
                    setStatus("ì—‘ì…€ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (í—¤ë” + í•œ ì¤„ ì´ìƒ í•„ìš”)", "error");
                    return;
                }

                const header = rows[0].map(h => (h || "").toString().trim());
                const idxName     = header.indexOf("ì´ë¦„");
                const idxNick     = header.indexOf("ë‹‰ë„¤ì„");
                const idxMaxTier  = header.indexOf("ìµœê³ í‹°ì–´");
                const idxCurrTier = header.indexOf("í˜„ì¬ í‹°ì–´");
                const idxMainPos  = header.indexOf("ì£¼í¬ì§€ì…˜");
                const idxSubPos   = header.indexOf("ë¶€í¬ì§€ì…˜");
                const idxAttend   = header.indexOf("ì°¸ì„ë¥ ");

                if (idxName === -1 || idxNick === -1 || idxMainPos === -1 || idxSubPos === -1) {
                    setStatus(
                        "ì—‘ì…€ ì²« ì¤„ì— 'ì´ë¦„ / ë‹‰ë„¤ì„ / ìµœê³ í‹°ì–´ / í˜„ì¬ í‹°ì–´ / ì£¼í¬ì§€ì…˜ / ë¶€í¬ì§€ì…˜ / ì°¸ì„ë¥ ' í—¤ë”ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.",
                        "error"
                    );
                    return;
                }

                const dataRows = rows.slice(1);
                const parsed = dataRows
                    .map(row => {
                        if (!row || row.length === 0) return null;

                        const name     = (row[idxName]     || "").toString().trim();
                        const nick     = (row[idxNick]     || "").toString().trim();
                        const maxTier  = idxMaxTier  !== -1 ? (row[idxMaxTier]  || "").toString().trim() : "";
                        const currTier = idxCurrTier !== -1 ? (row[idxCurrTier] || "").toString().trim() : "";
                        const mainPos  = (row[idxMainPos]  || "").toString().trim();
                        const subPos   = (row[idxSubPos]   || "").toString().trim();
                        const attend   = idxAttend   !== -1 ? (row[idxAttend]   || "").toString().trim() : "";

                        if (!name && !nick) return null;

                        return {
                            name,
                            nick,
                            tier: currTier || maxTier,
                            mainPos,
                            subPos,
                            maxTier,
                            attend
                        };
                    })
                    .filter(Boolean);

                friendsData = parsed;
                resetAllState();

                if (friendsData.length === 0) {
                    setStatus("ì—‘ì…€ì—ì„œ ìœ íš¨í•œ ì¹œêµ¬ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", "error");
                } else {
                    setStatus(
                        `ì—‘ì…€ì—ì„œ ì¹œêµ¬ ${friendsData.length}ëª…ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ì´ì œ ëœë¤ ì„ íƒìœ¼ë¡œ ê²½ë§¤ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                        "ok"
                    );
                }
            } catch (err) {
                console.error(err);
                setStatus("ì—‘ì…€ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
            }
        };

        reader.readAsArrayBuffer(file);
    }

    // ë‚¨ì€ ì¹œêµ¬ ì¤‘ ëœë¤ìœ¼ë¡œ 1ëª… ì„ íƒ
    function handleRandomFriend() {
        if (remainingFriends.length === 0) {
            setStatus("ë‚¨ì€ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. ë” ì´ìƒ ê²½ë§¤í•  ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.", "warn");
            return;
        }

        if (currentFriend) {
            setStatus("ì´ë¯¸ ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ê°€ ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ë‚™ì°° ë˜ëŠ” ìœ ì°°ì„ í•´ì£¼ì„¸ìš”.", "warn");
            return;
        }

        const idx = Math.floor(Math.random() * remainingFriends.length);
        const [picked] = remainingFriends.splice(idx, 1);

        currentFriend = picked;
        currentPrice = 0;
        currentLeaderId = null;

        updateTotalBadge();
        renderRemainingFriends();
        renderCurrentFriend();
        refreshAllBidderButtons();

        setStatus(`"${picked.name || picked.nick}" ë‹˜ì´ ê²½ë§¤ ëŒ€ìƒìœ¼ë¡œ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`, "ok");
    }

    // ì…ì°° ë²„íŠ¼ (+1)
    function handleBid(bidderId) {
        if (!currentFriend) {
            setStatus("ë¨¼ì € ëœë¤ìœ¼ë¡œ ê²½ë§¤ ëŒ€ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "warn");
            return;
        }

        const bidder = bidders.find(b => b.id === bidderId);
        if (!bidder) return;

        if (bidder.coins <= currentPrice) {
            setStatus(`${bidder.name}ë‹˜ì˜ ì½”ì¸ì´ ë¶€ì¡±í•˜ì—¬ ë” ì´ìƒ ì…ì°°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, "warn");
            updateBidderButtonState(bidderId);
            return;
        }

        currentPrice += 1;
        currentLeaderId = bidderId;

        currentPriceSpan.textContent = currentPrice.toString();
        currentLeaderSpan.textContent = bidder.name;

        refreshAllBidderButtons();
    }

    // ë‚™ì°° ë²„íŠ¼
    function handleFinishAuction() {
        if (!currentFriend) {
            setStatus("ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.", "warn");
            return;
        }
        if (!currentLeaderId) {
            setStatus("ìµœê³  ì…ì°°ìê°€ ì—†ìŠµë‹ˆë‹¤. ìµœì†Œ í•œ ë²ˆ ì´ìƒ ì…ì°° í›„ ë‚™ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "warn");
            return;
        }

        const winner = bidders.find(b => b.id === currentLeaderId);
        if (!winner) return;

        if (winner.coins < currentPrice) {
            setStatus("ë‚™ì°° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ë‚™ì°°ìì˜ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.", "error");
            return;
        }

        winner.coins -= currentPrice;

        auctionResults.push({
            friend: currentFriend,
            winnerId: winner.id,
            winnerName: winner.name,
            price: currentPrice
        });

        // í˜„ì¬ ê²½ë§¤ ì´ˆê¸°í™”
        currentFriend = null;
        currentPrice = 0;
        currentLeaderId = null;

        renderCurrentFriend();
        renderResults();
        refreshAllBidderButtons();

        setStatus(`"${winner.name}" ë‹˜ì´ ${currentPrice} ì½”ì¸ì— ë‚™ì°°ë˜ì—ˆìŠµë‹ˆë‹¤.`, "ok");
    }

    // ìœ ì°° ë²„íŠ¼
    function handleSkipAuction() {
        if (!currentFriend) {
            setStatus("ê²½ë§¤ ì¤‘ì¸ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.", "warn");
            return;
        }
        setStatus(`"${currentFriend.name || currentFriend.nick}" ë‹˜ì˜ ê²½ë§¤ê°€ ìœ ì°°ë˜ì—ˆìŠµë‹ˆë‹¤.`, "warn");

        // ë‹¤ì‹œ ë‚¨ì€ ëª©ë¡ ëì— ë¶™ì´ê¸° (ë‹¤ì‹œ ê²½ë§¤ ê°€ëŠ¥)
        remainingFriends.push(currentFriend);

        currentFriend = null;
        currentPrice = 0;
        currentLeaderId = null;

        updateTotalBadge();
        renderRemainingFriends();
        renderCurrentFriend();
        refreshAllBidderButtons();
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    excelInput.addEventListener("change", handleExcelFile);
    randomFriendButton.addEventListener("click", handleRandomFriend);
    resetAllButton.addEventListener("click", resetAllState);
    finishAuctionButton.addEventListener("click", handleFinishAuction);
    skipAuctionButton.addEventListener("click", handleSkipAuction);

    // ì²« ì§„ì… ì‹œ ê¸°ë³¸ ë Œë”ë§
    renderRemainingFriends();
    renderCurrentFriend();
    renderBidders();
    updateTotalBadge();
    setStatus("ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì„œ ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.", "warn");
</script>
</body>
</html>
